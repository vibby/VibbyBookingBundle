<?php

namespace Vibby\Bundle\BookingBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * EventRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class EventRepository extends EntityRepository {

  /**
   * Finds all events included in 2 dates.
   *
   * @return array Some event entities.
   */
  public function findByDates($date1, $date2) {
    $em = $this->getEntityManager();
    if ($date1 > $date2) {$temp = $date2; $date2 = $date1; $date1 = $date2; }
    $q = $em->createQuery(
            "select e
            from Vibby\Bundle\BookingBundle\Entity\Event e
            where
            not(
              (
                e.date_from > " . date('Y-m-d',strtotime($date2)) . "
              and
                e.date_from > " . date('Y-m-d',strtotime($date1)) . "
              ) or (
                e.date_to < " . date('Y-m-d',strtotime($date2)) . "
              and
                e.date_to < " . date('Y-m-d',strtotime($date1)) . "
              )
            )"
    );
    return $q->getResult();
  }

}